# -*- coding: utf-8 -*-
"""bot kaddelo.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1AbCPfVw1U51KrGlbcZKKBfidJ5W1Hy3g
"""

# –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ë–ò–ë–õ–ò–û–¢–ï–ö–ò
!pip install aiogram python-dotenv -q

# –ò–ú–ü–û–†–¢–ò–†–£–ï–ú –í–°–Å –ù–ï–û–ë–•–û–î–ò–ú–û–ï
import asyncio
import logging
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import Message
from aiogram.enums import ParseMode
from datetime import datetime
import sys

print("=" * 50)
print("üì¶ –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê")
print("=" * 50)
print("‚úÖ aiogram —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
print("‚úÖ python-dotenv —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
print("‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥–æ—Ç–æ–≤—ã")
print("=" * 50)

# ==== –í–ê–®–ò –î–ê–ù–ù–´–ï ====
BOT_TOKEN = "8543540956:AAGJI5ZpqEhbyByn8rD1hKnX7gUlin4xDhU"
ADMIN_ID = 1460213585  # –í–∞—à ID (–ø–æ–ª—É—á–µ–Ω –æ—Ç –±–æ—Ç–∞)

print("=" * 50)
print("üîß –ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ï–ö")
print("=" * 50)

try:
    bot = Bot(token=BOT_TOKEN)
    print("‚úÖ –ë–æ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞: {e}")
    sys.exit()

dp = Dispatcher()
subscribers = []  # –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (–≤ –ø–∞–º—è—Ç–∏)
client_requests = []  # –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤

print(f"üìä –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –≤ –ø–∞–º—è—Ç–∏: {len(subscribers)}")
print(f"üìã –ó–∞—è–≤–æ–∫ –≤ –ø–∞–º—è—Ç–∏: {len(client_requests)}")
print(f"üëë ID –∞–¥–º–∏–Ω–∞: {ADMIN_ID}")
print("=" * 50)

@dp.message(Command("start"))
async def start_command(message: Message):
    user_id = message.from_user.id
    user_name = message.from_user.full_name

    if user_id not in subscribers:
        subscribers.append(user_id)
        print(f"‚ûï –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫: {user_name} (ID: {user_id})")

    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
    keyboard = types.InlineKeyboardMarkup(
        inline_keyboard=[
            [types.InlineKeyboardButton(text="üìã –ü–û–†–Ø–î–û–ö –ü–û–õ–£–ß–ï–ù–ò–Ø –£–°–õ–£–ì–ò", callback_data="techplan_process")],
            [types.InlineKeyboardButton(text="üìû –û–°–¢–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£ –ù–ê –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Æ", callback_data="leave_request")],
        ]
    )

    welcome_text = f"""
üëã <b>–ü—Ä–∏–≤–µ—Ç, {user_name}!</b>

‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É –æ—Ç –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ì–ª–∞–π–±–æ—Ä–æ–¥–∞ –ò.–ê.!
üì¢ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:
‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º —É—Å–ª—É–≥–∞–º
‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ —Å–∫–∏–¥–∫–∏

üìä –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}

üëá <b> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</b>
"""

    await message.answer(welcome_text, parse_mode=ParseMode.HTML, reply_markup=keyboard)

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    await message.answer(
        "‚ÑπÔ∏è <b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "/help - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É\n"
        "/unsubscribe - –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏",
        parse_mode=ParseMode.HTML
    )

@dp.message(Command("help"))
async def help_command(message: Message):
    help_text = """
üìö <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ Kaddelo Bot</b>

–≠—Ç–æ –±–æ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ì–ª–∞–π–±–æ—Ä–æ–¥–∞ –ò.–ê.

<b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:</b>
‚Ä¢ üìã –ê–õ–ì–û–†–ò–¢–ú –ü–û–õ–£–ß–ï–ù–ò–Ø –£–°–õ–£–ì–ò - –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç
‚Ä¢ üìû –û–°–¢–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£ - –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º —É—Å–ª—É–≥–∞–º

<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/start - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/unsubscribe - –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏

<b>–î–ª—è —Å–≤—è–∑–∏:</b>
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é.
    """

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∏ –≤ —Å–ø—Ä–∞–≤–∫—É
    keyboard = types.InlineKeyboardMarkup(
        inline_keyboard=[
            [types.InlineKeyboardButton(text="üìã –ê–õ–ì–û–†–ò–¢–ú –ü–û–õ–£–ß–ï–ù–ò–Ø –£–°–õ–£–ì–ò", callback_data="techplan_process")],
            [types.InlineKeyboardButton(text="üìû –û–°–¢–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£", callback_data="leave_request")],
        ]
    )

    await message.answer(help_text, parse_mode=ParseMode.HTML, reply_markup=keyboard)

@dp.message(Command("unsubscribe"))
async def unsubscribe_command(message: Message):
    user_id = message.from_user.id

    if user_id in subscribers:
        subscribers.remove(user_id)
        await message.answer("‚ùå –í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏.")
        print(f"‚ûñ –û—Ç–ø–∏—Å–∞–ª—Å—è: ID {user_id}")
    else:
        await message.answer("‚ÑπÔ∏è –í—ã –Ω–µ –±—ã–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.")

print("‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ–±–∞–≤–ª–µ–Ω—ã!")

# ========== –û–°–ù–û–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ê ==========
@dp.message(Command("admin"))
async def admin_command(message: Message):
    """–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –∫–æ–º–∞–Ω–¥–∞ /admin"""
    if message.from_user.id != ADMIN_ID:
        await message.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return

    keyboard = types.ReplyKeyboardMarkup(
        keyboard=[
            [types.KeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")],
            [types.KeyboardButton(text="üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É")],
            [types.KeyboardButton(text="üõçÔ∏è –ü—Ä–∏–º–µ—Ä –∞–∫—Ü–∏–∏")],
            [types.KeyboardButton(text="‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å")],
        ],
        resize_keyboard=True,
        one_time_keyboard=False
    )

    admin_text = f"""
üõ†Ô∏è <b>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>

ü§ñ –ë–æ—Ç: Kaddelo Bot
üëë –ê–¥–º–∏–Ω: {message.from_user.full_name}
üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}
üìã –ó–∞—è–≤–æ–∫: {len(client_requests)}

<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ:</b>
    """
    await message.answer(admin_text, reply_markup=keyboard, parse_mode=ParseMode.HTML)

# ========== –ö–ù–û–ü–ö–ò –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò ==========
@dp.message(lambda message: message.text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" and message.from_user.id == ADMIN_ID)
async def stats_button(message: Message):
    """–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    stats_text = f"""
üìà <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Kaddelo Bot</b>

üë• –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: <b>{len(subscribers)}</b>
üìã –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫: <b>{len(client_requests)}</b>
üëë –ê–¥–º–∏–Ω ID: <code>{ADMIN_ID}</code>

<b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:</b>
"""
    if subscribers:
        last_subscribers = subscribers[-5:] if len(subscribers) >= 5 else subscribers
        for i, user_id in enumerate(last_subscribers, 1):
            stats_text += f"{i}. <code>{user_id}</code>\n"
    else:
        stats_text += "–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤\n"

    if client_requests:
        stats_text += f"\n<b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∑–∞—è–≤–∫–∏:</b>\n"
        for i, req in enumerate(client_requests[-3:], 1):
            stats_text += f"{i}. ID: <code>{req['user_id']}</code> ({req['timestamp'].strftime('%d.%m %H:%M')})\n"
    await message.answer(stats_text, parse_mode=ParseMode.HTML)

@dp.message(lambda message: message.text == "üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É" and message.from_user.id == ADMIN_ID)
async def mailing_button(message: Message):
    """–ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏"""
    if len(subscribers) == 0:
        await message.answer("‚ùå –ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏!")
        return

    mailing_text = f"""
üì§ <b>–ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å—Å—ã–ª–∫–µ!</b>

üë• –ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: {len(subscribers)}

<b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Ä–∞–∑–æ—Å–ª–∞—Ç—å:</b>
‚Ä¢ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç
‚Ä¢ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é
‚Ä¢ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ —Å –ø–æ–¥–ø–∏—Å—å—é

–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º {len(subscribers)} –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.
"""
    await message.answer(mailing_text, parse_mode=ParseMode.HTML, reply_markup=types.ReplyKeyboardRemove())

@dp.message(lambda message: message.text == "üõçÔ∏è –ü—Ä–∏–º–µ—Ä –∞–∫—Ü–∏–∏" and message.from_user.id == ADMIN_ID)
async def promo_example_button(message: Message):
    """–ü—Ä–∏–º–µ—Ä –∞–∫—Ü–∏–∏ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = types.InlineKeyboardMarkup(
        inline_keyboard=[
            [types.InlineKeyboardButton(text="üìã –ê–õ–ì–û–†–ò–¢–ú –ü–û–õ–£–ß–ï–ù–ò–Ø –£–°–õ–£–ì–ò", callback_data="techplan_process")],
            [types.InlineKeyboardButton(text="üìû –û–°–¢–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£", callback_data="leave_request")],
        ]
    )

    promo_text = """
üî• <b>–ê–ö–¶–ò–Ø –û–¢ KADDELO!</b>

üéÅ <b>–°–ö–ò–î–ö–ê 10%</b> –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –Ω–µ–∂–∏–ª–æ–≥–æ –∑–¥–∞–Ω–∏—è:
‚Ä¢ –ì–∞—Ä–∞–∂
‚Ä¢ –õ–µ—Ç–Ω—è—è –∫—É—Ö–Ω—è
‚Ä¢ –•–æ–∑–±–ª–æ–∫
‚è∞ –¢–æ–ª—å–∫–æ –¥–æ 20 —è–Ω–≤–∞—Ä—è!

‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç
‚úÖ –°—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑

üí¨ –û—Å—Ç–∞–≤–ª—è–π—Ç–µ –∑–∞—è–≤–∫—É –ø—Ä—è–º–æ –≤ –±–æ—Ç–µ!
"""
    await message.answer("üìù <b>–ü—Ä–∏–º–µ—Ä —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:</b>", parse_mode=ParseMode.HTML)
    await message.answer(promo_text, reply_markup=keyboard, parse_mode=ParseMode.HTML)
    await message.answer("üìã <i>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π</i>", parse_mode=ParseMode.HTML)

# ========== INLINE-–ö–ù–û–ü–ö–ò –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ==========
@dp.callback_query(lambda c: c.data == "techplan_process")
async def techplan_process_handler(callback_query: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ —Å –ø–æ—Ä—è–¥–∫–æ–º –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —Ç–µ—Ö–ø–ª–∞–Ω–∞"""
    process_text = """
üìã <b>–ü–û–†–Ø–î–û–ö –ü–û–õ–£–ß–ï–ù–ò–Ø –£–°–õ–£–ì–ò:</b>

1Ô∏è‚É£ <b>–ò–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</b> –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞
2Ô∏è‚É£ <b>–í—ã–µ–∑–¥ –Ω–∞ –æ–±—ä–µ–∫—Ç</b> –¥–ª—è –æ–±–º–µ—Ä–æ–≤
3Ô∏è‚É£ <b>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∑–¥–∞–Ω–∏—è)</b>
4Ô∏è‚É£ <b>–ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–∫–∞–∑—á–∏–∫—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞ CD –¥–∏—Å–∫–µ</b>


‚è±Ô∏è <b>–°—Ä–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:</b> 2-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è
"""
    action_keyboard = types.InlineKeyboardMarkup(
        inline_keyboard=[[types.InlineKeyboardButton(text="üìû –û–°–¢–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£", callback_data="leave_request")]]
    )
    await callback_query.message.answer(process_text, parse_mode=ParseMode.HTML, reply_markup=action_keyboard)
    await callback_query.answer()

@dp.callback_query(lambda c: c.data == "leave_request")
async def leave_request_handler(callback_query: types.CallbackQuery):
    """–ó–∞–ø—Ä–æ—Å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    request_text = """
üìù <b>–û–¢–ü–†–ê–í–¨–¢–ï –í–ê–®–ï –°–û–û–ë–©–ï–ù–ò–ï</b>

–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞.
"""
    await callback_query.message.answer(request_text, parse_mode=ParseMode.HTML)
    await callback_query.answer("‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç")

# ========== –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–ô –û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ==========
@dp.message(lambda message: message.text and not message.text.startswith('/') and message.from_user.id != ADMIN_ID)
async def handle_user_message(message: Message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–∫ –∑–∞—è–≤–æ–∫"""
    user_id = message.from_user.id
    user_name = message.from_user.full_name or "–ë–µ–∑ –∏–º–µ–Ω–∏"
    username = message.from_user.username or "–ù–µ—Ç username"

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É
    client_requests.append({
        'user_id': user_id,
        'user_name': user_name,
        'username': username,
        'timestamp': datetime.now(),
        'status': '–Ω–æ–≤–∞—è',
        'message': message.text
    })

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await message.answer(
        f"‚úÖ <b>–°–û–û–ë–©–ï–ù–ò–ï –û–¢–ü–†–ê–í–õ–ï–ù–û!</b>\n\n"
        f"–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –∏–Ω–∂–µ–Ω–µ—Ä –ø–æ–ª—É—á–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–≤—è–∂–µ—Ç—Å—è —Å –í–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è.",
        parse_mode=ParseMode.HTML
    )

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
    request_message = f"""
üö® <b>–ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –û–¢ –ö–õ–ò–ï–ù–¢–ê!</b>

üë§ <b>–ö–ª–∏–µ–Ω—Ç:</b> {user_name}
üì± <b>Username:</b> @{username}
üÜî <b>ID:</b> <code>{user_id}</code>
‚è∞ <b>–í—Ä–µ–º—è:</b> {datetime.now().strftime('%d.%m.%Y %H:%M')}

üí¨ <b>–°–æ–æ–±—â–µ–Ω–∏–µ:</b>
{message.text}
"""

    await bot.send_message(
        ADMIN_ID,
        request_message,
        parse_mode=ParseMode.HTML,
        reply_markup=types.InlineKeyboardMarkup(
            inline_keyboard=[[
                types.InlineKeyboardButton(text="üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É", callback_data=f"write_{user_id}"),
                types.InlineKeyboardButton(text="‚úÖ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É", callback_data=f"take_{user_id}"),
            ]]
        )
    )

# ========== –ö–ù–û–ü–ö–ò –î–õ–Ø –ê–î–ú–ò–ù–ê –í –£–í–ï–î–û–ú–õ–ï–ù–ò–ò ==========
@dp.callback_query(lambda c: c.data.startswith("write_"))
async def write_to_client_handler(callback_query: types.CallbackQuery):
    """–ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É" - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É"""
    if callback_query.from_user.id != ADMIN_ID:
        await callback_query.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return

    user_id = callback_query.data.replace("write_", "")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ—Ç –∏–º–µ–Ω–∏ –±–æ—Ç–∞
    try:
        await bot.send_message(
            chat_id=int(user_id),
            text="üë∑‚Äç‚ôÇÔ∏è <b>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞</b>\n\n"
                 "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!–ü–æ–ª—É—á–∏–ª –í–∞—à—É –∑–∞—è–≤–∫—É,—Ä–∞—Å—Å–º–æ—Ç—Ä—é –≤ —Ç–µ—á–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è.–ü–æ–∫–∞ –í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏ –∏ –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –∑–∞–∫–∞–∑—É",
            parse_mode=ParseMode.HTML
        )

        # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –∞–¥–º–∏–Ω—É
        await callback_query.message.answer(
            f"‚úÖ <b>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É!</b>\n\n"
            f"üë§ ID –∫–ª–∏–µ–Ω—Ç–∞: <code>{user_id}</code>\n"
            f"üí¨ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.",
            parse_mode=ParseMode.HTML
        )

        await callback_query.answer("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É!")

    except Exception as e:
        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
        await callback_query.message.answer(
            f"‚ùå <b>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</b>\n\n"
            f"–û—à–∏–±–∫–∞: {str(e)}\n\n"
            f"üÜî ID –∫–ª–∏–µ–Ω—Ç–∞: <code>{user_id}</code>",
            parse_mode=ParseMode.HTML
        )
        await callback_query.answer("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("take_"))
async def take_request_handler(callback_query: types.CallbackQuery):
    """–ö–Ω–æ–ø–∫–∞ "–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É" –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏"""
    if callback_query.from_user.id != ADMIN_ID:
        await callback_query.answer("‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω", show_alert=True)
        return
    user_id = callback_query.data.replace("take_", "")
    for request in client_requests:
        if str(request['user_id']) == user_id:
            request['status'] = '–≤ —Ä–∞–±–æ—Ç–µ'
            request['taken_at'] = datetime.now()
            break
    await callback_query.message.edit_text(
        callback_query.message.text + f"\n\n‚úÖ <b>–ó–∞—è–≤–∫–∞ –≤–∑—è—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É</b>\n–í—Ä–µ–º—è: {datetime.now().strftime('%H:%M')}",
        parse_mode=ParseMode.HTML
    )
    await callback_query.answer("‚úÖ –ó–∞—è–≤–∫–∞ –≤–∑—è—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É!")

@dp.message(lambda message: message.text == "‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å" and message.from_user.id == ADMIN_ID)
async def close_panel_button(message: Message):
    """–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏"""
    await message.answer("–ü–∞–Ω–µ–ª—å –∑–∞–∫—Ä—ã—Ç–∞. –ù–∞–ø–∏—à–∏—Ç–µ /admin —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–Ω–æ–≤–∞.", reply_markup=types.ReplyKeyboardRemove())

print("‚úÖ –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!")

@dp.message(lambda message: message.from_user.id == ADMIN_ID)
async def handle_admin_mailing(message: Message):
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
    if message.text in ["üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É", "üõçÔ∏è –ü—Ä–∏–º–µ—Ä –∞–∫—Ü–∏–∏", "‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å"]:
        return

    # –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    if len(subscribers) == 0:
        await message.answer("‚ùå –ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏!")
        return

    # –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫—É
    await message.answer(f"üîÑ –ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É –Ω–∞ {len(subscribers)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")

    success_count = 0
    failed_count = 0

    # –†–∞—Å—Å—ã–ª–∞–µ–º –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
    for user_id in subscribers:
        try:
            # –ï—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ç–æ
            if message.photo:
                await bot.send_photo(
                    chat_id=user_id,
                    photo=message.photo[-1].file_id,
                    caption=message.caption or "",
                    parse_mode=ParseMode.HTML
                )

            # –ï—Å–ª–∏ —ç—Ç–æ –≤–∏–¥–µ–æ
            elif message.video:
                await bot.send_video(
                    chat_id=user_id,
                    video=message.video.file_id,
                    caption=message.caption or "",
                    parse_mode=ParseMode.HTML
                )

            # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
            else:
                await bot.send_message(
                    chat_id=user_id,
                    text=message.text or message.caption or "",
                    parse_mode=ParseMode.HTML
                )

            success_count += 1

            # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã Telegram
            await asyncio.sleep(0.05)

        except Exception as e:
            failed_count += 1
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")

    # –û—Ç—á–µ—Ç –æ —Ä–∞—Å—Å—ã–ª–∫–µ
    report_text = f"""
‚úÖ <b>–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>

üìä <b>–û—Ç—á–µ—Ç:</b>
‚îú –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: <b>{success_count}</b>
‚îú –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: <b>{failed_count}</b>
‚îî –í—Å–µ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π: <b>{len(subscribers)}</b>

<i>–î–ª—è –Ω–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ "üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É"</i>
"""

    await message.answer(report_text, parse_mode=ParseMode.HTML)

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω—Å–æ–ª–∏ Colab
    print("=" * 50)
    print("üìä –û–¢–ß–ï–¢ –û –†–ê–°–°–´–õ–ö–ï")
    print("=" * 50)
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {success_count}")
    print(f"‚ùå –û—à–∏–±–∫–∏: {failed_count}")
    print(f"üë• –í—Å–µ–≥–æ: {len(subscribers)}")
    print("=" * 50)

print("‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—ã–ª–∫–∏ –≥–æ—Ç–æ–≤–∞!")

async def main():
    print("=" * 60)
    print("üöÄ –ó–ê–ü–£–°–ö–ê–ï–ú –ë–û–¢–ê –ö–ê–î–ê–°–¢–†–û–í–û–ì–û –ò–ù–ñ–ï–ù–ï–†–ê")
    print("=" * 60)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É
    try:
        bot_info = await bot.get_me()
        print(f"‚úÖ –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω: @{bot_info.username}")
        print(f"‚úÖ –ò–º—è –±–æ—Ç–∞: {bot_info.first_name}")
        print(f"‚úÖ ID –±–æ—Ç–∞: {bot_info.id}")
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –Ø—á–µ–π–∫–µ 2")
        return

    print("\n" + "=" * 60)
    print("üì± –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –†–ê–ë–û–¢–´:")
    print("=" * 60)
    print("1Ô∏è‚É£ –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ")
    print("2Ô∏è‚É£ –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: @my_kaddelo_bot")
    print("3Ô∏è‚É£ –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É /start (—á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è)")
    print("\n4Ô∏è‚É£ –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ —Å–æ —Å–≤–æ–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–∞–¥–º–∏–Ω–∞)")
    print("5Ô∏è‚É£ –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /admin")
    print("6Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")
    print("   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∏ –∑–∞—è–≤–∫–∏")
    print("   üì¢ –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º")
    print("   üõçÔ∏è –ü—Ä–∏–º–µ—Ä –∞–∫—Ü–∏–∏ - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —à–∞–±–ª–æ–Ω —Å –∫–Ω–æ–ø–∫–∞–º–∏")
    print("   ‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å - —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫–∏")
    print("\n" + "=" * 60)
    print("‚ö†Ô∏è  –í–ê–ñ–ù–û: –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∫–∞ –æ—Ç–∫—Ä—ã—Ç Colab")
    print("‚èπÔ∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: –ù–∞–∂–º–∏—Ç–µ Stop –≤ Colab")
    print("=" * 60 + "\n")

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    try:
        await dp.start_polling(bot)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞: {e}")
    finally:
        await bot.session.close()
        print("üëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

print("üéØ –ù–∞–∂–º–∏—Ç–µ ‚ñ∂Ô∏è —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞...")
print("–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram")

# –ó–∞–ø—É—Å–∫ –≤ Colab —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º nest_asyncio
!pip install nest_asyncio -q
import nest_asyncio
nest_asyncio.apply()

import asyncio
asyncio.run(main())